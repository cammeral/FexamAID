<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ุงูุงูุชุญุงู ุงูููุงุฆู</title>
<style>
    body {
        font-family: Tahoma, sans-serif;
        background: #f4f6f8;
        color: #333;
        text-align: center;
        padding: 20px;
    }
    .box {
        background: white;
        padding: 20px;
        border-radius: 15px;
        max-width: 600px;
        margin: auto;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    input, textarea, button {
        width: 90%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
    }
    button {
        background: #28a745;
        color: white;
        border: none;
        cursor: pointer;
    }
    button:disabled {
        background: #999;
        cursor: not-allowed;
    }
    #timer {
        font-size: 20px;
        font-weight: bold;
        margin: 10px 0;
        color: #e53935;
    }
</style>
</head>
<body>

<div id="start-screen" class="box">
    <h2>ุฃุฏุฎู ุจูุงูุงุชู ูุจุฏุก ุงูุงูุชุญุงู</h2>
    <input type="text" id="studentName" placeholder="ุงุณูู" required>
    <input type="text" id="college" placeholder="ุงููููุฉ" required>
    <button onclick="showIntro()">ุงูุชุงูู</button>
</div>

<div id="intro-screen" class="box" style="display:none;">
    <h2>ูุฑุญุจุงู ุจู ูู ุงูุงูุชุญุงู ุงูููุงุฆู</h2>
    <p>๐ ูุชููู ูู ุงูุชูููู ูุงููุฌุงุญ</p>
    <p>๐ ุชุนูููุงุช:</p>
    <ul style="text-align:right;">
        <li>ููู ุณุคุงู 5 ุฏูุงุฆู</li>
        <li>ูุง ููููู ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู ุญุชู ูุฑูุฑ 3 ุฏูุงุฆู ุนูู ุงูุฃูู</li>
        <li>ุงูุฅุฌุงุจุงุช ุชูุญูุธ ุชููุงุฆูุงู</li>
    </ul>
    <button onclick="startExam()">ุงุจุฏุฃ ุงูุงูุชุญุงู</button>
</div>

<div id="exam-screen" class="box" style="display:none;">
    <h3 id="question-text"></h3>
    <div id="timer"></div>
    <textarea id="answer" rows="6" placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง..."></textarea>
    <br>
    <button id="submit-btn" onclick="submitAnswer()" disabled>ุฅุฑุณุงู ุงูุฅุฌุงุจุฉ</button>
</div>

<div id="finish-screen" class="box" style="display:none;">
    <h2>โ ุชู ุฅููุงู ุงูุงูุชุญุงู</h2>
    <p>ุดูุฑูุง ููุดุงุฑูุชู</p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyM89Yn2JJ1lNLk-HxEIndhdEeh4Me9fTNLlSUMJs40H_6gjsVDAuesrvTH_GeCYbVKOg/exec"; // ๐ด ุนุฏูู ุจุฑุงุจุท Google Apps Script
let questions = [];
let currentQuestionIndex = 0;
let timerInterval;
let startTime, submitTime;
let studentName = "", college = "";

function showIntro() {
    studentName = document.getElementById('studentName').value.trim();
    college = document.getElementById('college').value.trim();
    if (!studentName || !college) {
        alert("ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณูู ูุงููููุฉ");
        return;
    }
    document.getElementById('start-screen').style.display = "none";
    document.getElementById('intro-screen').style.display = "block";
}

async function startExam() {
    document.getElementById('intro-screen').style.display = "none";
    document.getElementById('exam-screen').style.display = "block";
    await loadQuestions();
    showQuestion();
}

async function loadQuestions() {
    let res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({action: "getQuestions"})
    });
    questions = await res.json();
}

function showQuestion() {
    if (currentQuestionIndex >= questions.length) {
        document.getElementById('exam-screen').style.display = "none";
        document.getElementById('finish-screen').style.display = "block";
        return;
    }
    let q = questions[currentQuestionIndex];
    document.getElementById('question-text').innerText = q.text;
    document.getElementById('answer').value = "";
    document.getElementById('submit-btn').disabled = true;

    startTime = new Date();
    let totalSeconds = q.time * 60; // 5 ุฏูุงุฆู
    let canSubmitAfter = 180; // 3 ุฏูุงุฆู = 180 ุซุงููุฉ

    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        totalSeconds--;
        let minutes = Math.floor(totalSeconds / 60);
        let seconds = totalSeconds % 60;
        document.getElementById('timer').innerText = `ุงูููุช ุงููุชุจูู: ${minutes}:${seconds.toString().padStart(2, '0')}`;

        if (totalSeconds <= q.time * 60 - canSubmitAfter) {
            document.getElementById('submit-btn').disabled = false;
        }

        if (totalSeconds <= 0) {
            clearInterval(timerInterval);
            submitAnswer();
        }
    }, 1000);
}

async function submitAnswer() {
    submitTime = new Date();
    let answerText = document.getElementById('answer').value.trim();
    let q = questions[currentQuestionIndex];

    await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({
            action: "saveAnswer",
            studentName: studentName,
            college: college,
            questionId: q.id,
            questionText: q.text,
            answerText: answerText,
            startTime: startTime.toLocaleString(),
            submitTime: submitTime.toLocaleString()
        })
    });

    currentQuestionIndex++;
    showQuestion();
}
</script>
</body>
</html>
